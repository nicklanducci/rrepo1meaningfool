<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <title>Vertical x3 • Template Background Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body {
      height: 100%;
      margin: 0;
      background:#000;
      color:#fff;
      overflow:hidden;
    }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    /* Sfondo full-screen con il template 1920x1080 */
    .stage {
      position: fixed;
      inset: 0;
      background: url("rearprojectiontemplate.jpg") center center / cover no-repeat;
    }

    /* Ogni viewport coincide con un rettangolo blu del template.
       Posizioni in % calcolate da 1920x1080. */
    .viewport {
      position: absolute;
      overflow: hidden;
      display: flex;
      justify-content: center; /* centra orizzontalmente il testo nella barra */
      /* border: 1px solid rgba(255,255,255,0.5);  <-- scommenta per debug bordi */
      box-sizing: border-box;
    }

    /* Colonne laterali: testo appoggiato in basso (bottom-up) */
    .viewport.mode-left  { align-items: flex-end; }

    /* Colonna centrale: testo centrato verticalmente */
    .viewport.mode-spine { align-items: center; }

    /* Linea di testo verticale */
    .line {
      writing-mode: vertical-rl;
      white-space: nowrap;
      line-height: 1.09;
      font-size: clamp(28px, 6vw, 120px);
      transform-origin: center;
      will-change: transform;
      user-select: none;
    }

    /* Colonne 1 e 3: bottom-up (ruotate) */
    .line.left {
      text-orientation: mixed;
      transform: rotate(180deg);
    }

    /* Colonna centrale: spine, testo che “leggi girando il libro” */
    .line.spine {
      text-orientation: sideways;
      transform: none; /* niente rotazione */
    }

    /* Cursore inline alla fine del testo */
    .cursor {
      display:inline-block;
      width:1ch;
      text-align:center;
      animation: blink 1s step-end infinite;
    }
    .cursor::after { content:"▌"; }

    @keyframes blink { 50% { opacity:0; } }
  </style>
</head>
<body>
  <div class="stage">
    <!-- Colonna 1: x=308, y=78, w=317, h=935 -->
    <div
      class="viewport mode-left"
      id="viewport1"
      style="
        left:16.0417%;
        top:7.2222%;
        width:16.5104%;
        height:86.5741%;
      "
    >
      <div class="line left" id="line1">
        <span id="text1"></span><span class="cursor" id="cursor1"></span>
      </div>
    </div>

    <!-- Colonna centrale (spine): x=939, y=44, w=265, h=935 -->
    <div
      class="viewport mode-spine"
      id="viewport2"
      style="
        left:48.9063%;
        top:4.0741%;
        width:13.8021%;
        height:86.5741%;
      "
    >
      <div class="line spine" id="line2">
        <span id="text2"></span><span class="cursor" id="cursor2"></span>
      </div>
    </div>

    <!-- Colonna 3: x=1468, y=41, w=322, h=935 -->
    <div
      class="viewport mode-left"
      id="viewport3"
      style="
        left:76.4583%;
        top:3.7963%;
        width:16.7708%;
        height:86.5741%;
      "
    >
      <div class="line left" id="line3">
        <span id="text3"></span><span class="cursor" id="cursor3"></span>
      </div>
    </div>
  </div>

  <script>
    // ===== FRASE DI TEST (loop, nessuna API) =====
    const SAMPLE = "The sculpture exists only when unseen.";

    // ===== TYPING SPEED (uguale a prima, lenta e leggibile) =====
    const CHAR_MS   = 170;
    const SPACE_MS  = 280;
    const COMMA_MS  = 520;
    const PERIOD_MS = 1000;
    const DASH_MS   = 650;

    function delayFor(ch) {
      if (ch === " ") return CHAR_MS + SPACE_MS;
      if (/[,\u061B;]/.test(ch)) return CHAR_MS + COMMA_MS;
      if (/[.!?]/.test(ch))      return CHAR_MS + PERIOD_MS;
      if (/[\u2013\u2014-]/.test(ch)) return CHAR_MS + DASH_MS;
      if (ch === "\u2026") return CHAR_MS + PERIOD_MS;
      return CHAR_MS;
    }

    // Setup generico di una colonna (solo typing + loop, nessuno scroll complicato)
    function setupColumn(textId) {
      const textSpan = document.getElementById(textId);
      const chars = Array.from(SAMPLE);

      function startLoop() {
        textSpan.textContent = "";
        let i = 0;

        function typeNext() {
          if (i >= chars.length) {
            // una volta finita la frase, piccolo delay e ricomincia
            setTimeout(startLoop, 1200);
            return;
          }
          const ch = chars[i++];
          textSpan.textContent += (ch === "\n") ? " " : ch;
          setTimeout(typeNext, delayFor(ch));
        }

        setTimeout(typeNext, 600); // piccolo ritardo prima di iniziare
      }

      startLoop();
    }

    // Colonne: usiamo solo l'id della parte testuale
    setupColumn("text1"); // left
    setupColumn("text2"); // spine (centrale)
    setupColumn("text3"); // left

    // Nessun resize speciale necessario: le viewports sono in %,
    // lo sfondo fa cover mantenendo il ratio.
  </script>
</body>
</html>
